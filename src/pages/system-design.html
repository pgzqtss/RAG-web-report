<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>System Design - QuickStart Bootstrap Template</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="../../assets/img/favicon.png" rel="icon">
  <link href="../../assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../../assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="../../assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="../../assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="../../assets/css/main.css" rel="stylesheet">

  <!-- Enhanced Styles -->
  <style>
    body {
      background: linear-gradient(135deg, #f8f9fa 0%, #f1f3f5 100%);
      font-family: 'Inter', sans-serif;
      color: #2d3748;
    }

    .system-hero {
      background: linear-gradient(135deg, #6f2fb8 0%, #f7672f 100%);
      padding: 8rem 0;
      position: relative;
      overflow: hidden;
    }

    .system-hero::before {
      content: '';
      position: absolute;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      transform: translate(-25%, -50%);
    }

    .clickable-file {
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .clickable-file:hover {
      background-color: #3a3a3a;
    }

    .content-card {
      background: white;
      border-radius: 1.5rem;
      padding: 2.5rem;
      margin: 2rem 0;
      box-shadow: 0 12px 24px -8px rgba(111,47,184,0.1);
      transition: transform 0.3s ease;
    }

    .tech-card {
      background: #fff;
      border-radius: 1rem;
      padding: 1.5rem;
      margin: 1rem 0;
      box-shadow: 0 8px 16px -4px rgba(111,47,184,0.1);
      transition: transform 0.3s ease;
    }

    h2 {
      position: relative;
      padding-left: 1.5rem;
      margin-bottom: 2rem;
    }

    h2::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0.35em;
      height: 1.2em;
      width: 5px;
      background: #6f2fb8;
      border-radius: 3px;
    }

    .code-block {
      background: #2d2d2d;
      color: #f8f8f8;
      padding: 1.5rem;
      border-radius: 0.75rem;
      font-family: 'Roboto Mono', monospace;
    }

    .requirements-content table, .system-design-content table {
      font-size: 18px;
      color: #333;
      background-color: #fff;
      margin: 20px 0;
      width: 100%;
      border-collapse: collapse;
    }

    .requirements-content th, .system-design-content th {
      background-color: #6f2fb8;
      color: #fff;
      font-weight: bold;
      text-align: center;
      padding: 12px;
    }

    .requirements-content td, .system-design-content td {
      text-align: left;
      padding: 12px;
      border-bottom: 1px solid #eee;
    }

    .requirements-content tr:hover, .system-design-content tr:hover {
      background-color: #f9f9f9;
    }

    .diagram-container {
      margin: 2rem 0;
      text-align: center;
    }

    .diagram-container img {
      max-width: 100%;
      border-radius: 0.75rem;
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }

    .diagram-container p {
      margin-top: 1rem;
      font-style: italic;
      color: #666;
    }

    @media (max-width: 768px) {
      .system-hero { padding: 4rem 0; }
      .content-card { padding: 1.5rem; }
    }

    .implementation-section {
    padding: 2.5rem;
  }
  
  .section-title {
    font-size: 2rem;
    color: #6f2fb8;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #f0f0f0;
  }
  
  .subsection-title {
    font-size: 1.5rem;
    color: #333;
    margin: 1.5rem 0 1rem;
  }
  
  .process-title, .results-title {
    font-size: 1.3rem;
    color: #444;
    margin: 2rem 0 1rem;
    padding-left: 1rem;
    border-left: 4px solid #f7672f;
  }
  
  .comparison-title {
    font-size: 1.2rem;
    color: #555;
    margin: 1.5rem 0 0.5rem;
  }
  
  /* File Cards */
  .file-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin: 1.5rem 0;
  }
  
  .file-card {
    background: #ffffff;
    border-radius: 10px;
    padding: 1.5rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    border-top: 3px solid #6f2fb8;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  .file-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.12);
  }
  
  .file-title {
    font-size: 1.1rem;
    color: #6f2fb8;
    margin-bottom: 0.5rem;
  }
  
  .file-description {
    color: #666;
    margin-bottom: 1rem;
    font-style: italic;
  }
  
  .steps-list {
    padding-left: 1.2rem;
    margin: 1rem 0;
  }
  
  .steps-list li {
    margin-bottom: 0.5rem;
    color: #555;
  }
  
  /* Output Cards */
  .output-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin: 1.5rem 0;
  }
  
  .output-card {
    background: #ffffff;
    border-radius: 10px;
    padding: 1.5rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    border: 1px solid #eee;
    transition: all 0.3s ease;
    cursor: pointer;
  }
  
  .output-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.12);
    border-color: #6f2fb8;
  }
  
  .output-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }
  
  .file-indicator {
    font-size: 0.8rem;
    color: #f7672f;
    font-weight: 500;
  }
  
  .output-preview {
    display: flex;
    align-items: center;
    color: #666;
  }
  
  .output-preview i {
    margin-right: 0.5rem;
    font-size: 1.2rem;
  }
  
  /* Text Styles */
  .intro-text, .process-description, .comparison-description, .results-text, .additional-info {
    line-height: 1.7;
    color: #555;
    margin-bottom: 1.2rem;
  }
  
  /* Responsive Adjustments */
  @media (max-width: 768px) {
    .file-cards, .output-cards {
      grid-template-columns: 1fr;
    }
    
    .implementation-section {
      padding: 1.5rem;
    }
  }
  </style>
</head>

<body>

<!-- ======= Header ======= -->
<header id="header" class="header d-flex align-items-center fixed-top">
  <div class="container-fluid container-xl position-relative d-flex align-items-center">
    <a href="../../index.html" class="logo d-flex align-items-center me-auto">
      <img src="assets/img/logo.png" alt="">
      <h1 class="sitename">Rag-n-Bones</h1>
    </a>

    <nav id="navmenu" class="navmenu">
      <ul>
        <li><a href="../../index.html">Home</a></li>
        <li><a href="requirements.html">Requirements</a></li>
        <li><a href="research.html">Research</a></li>
        <li><a href="algorithm.html">Algorithm</a></li>
        <li><a href="system-design.html" class="active">System Design</a></li>
        <li><a href="implements.html">Implements</a></li>
        <li><a href="testing.html">Testing</a></li>
        <li><a href="evaluation.html">Evaluation</a></li>
        <li><a href="appendix.html">Appendix</a></li>
      </ul>
      <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
    </nav>

  </div>
</header>

<main id="main">
  <!-- Hero Section -->
  <section class="system-hero">
    <div class="container" data-aos="fade-up">
      <h1>SYSTEM DESIGN</h1>
    </div>
  </section>

  <!-- Content Section -->
  <section class="system-content">
    <div class="container" data-aos="fade-up">
      
      <div class="content-card">
        <h2>System Architecture</h2>
        <p>
          The overall system is made up of a frontend component with the Next.js React framework, a backend component with the web framework Flask in Python, and a database component containing the SQL database and the vector database.
        </p>
        <p>
          Next.js is responsible for receiving requests from the user such as storing PDFs, which is done in the frontend component to display said PDFs to the end user easily and removes the need for a proxy when the backend retrieves those files. Furthermore, it can send API requests to the backend and display the response on the web page. 
        </p>
        <p>
          The backend utilises the Flask microweb framework, which can interact with the frontend to handle API requests. It can upload and retrieve relevant text chunks from the Pinecone vector database and read/write data to the SQL database. Flask also interacts with OpenAI’s large language models to generate the systematic review.
        </p>
        <p>
          The Pinecone vector database is made up of text chunks converted to vectors, which contain metadata of the text’s origin, section category and plaintext. Querying the database yields the most related text chunk and is returned to the backend. The SQL database stores user details as well as previously generated systematic reviews linked with users. SQL statements are used to add, delete and retrieve data from tables, which is returned to the backend in JSON format.
        </p>
        
        <div class="diagram-container">
          <!-- Replace with your actual image path -->
          <img src="../../assets/img/system_architecture.png" alt="System Architecture Flowchart">
          <p><em>Figure 1: System architecture diagram of the RAG backend</em></p>
        </div>


        <h3>Sequence Diagrams</h3>
        <p>
          This is a sequence diagram that demonstrates the interactions between each system component (including the frontend, backend and databases) in sequential order when the user generates a systematic review. 
        </p>

        <div class="diagram-container">
          <!-- Replace with your actual image path -->
          <img src="../../assets/img/sequence_diagram.png" alt="System Architecture Flowchart">
          <p><em>Figure 2: Sequence diagram of the systematic review generation process</em></p>
        </div>

        
      </div>

      <div class="content-card">
        <h2>Data Storage</h2>
        <h3>ER Diagram</h3>
        <p>
          This is an entity-relationship (ER) diagram of the SQL database we use to store the user’s login information and the history of systematic reviews. For one user, there can be zero or many systematic reviews (history) linked with them. This linkage is done between the user_id. The ‘timestamp’ datatype stores the date and time and is generated by MySQL when the instance of the table entry is created. 
        </p>

        <div class="diagram-container">
          <!-- Replace with your actual image path -->
          <img src="../../assets/img/er_diagram.png" alt="System Architecture Flowchart">
          <p><em>Figure 3: Entity-relationship (ER) of the SQL database</em></p>
        </div>
      </div>

      <div class="content-card">
        <h2>Packages and APIs</h2>
        <p>
          [Describe your package structure and API definitions]
        </p>
      </div>

      <div class="content-card implementation-section">
        <h2 class="section-title">Implementation</h2>
        
        <div class="experiment-intro">
          <h3 class="subsection-title">Experiment on Fine-tuning</h3>
          <p class="intro-text">
            We were thinking of improving accuracy and relevancy, so we planned to fine-tune a language model to achieve better performance. 
            However, due to various reasons such as GPU limitation, cost limitation, time limitation, we stopped implementing. 
            The fine-tuning code is available in our GitHub, called model_agent in backend. Here is the process of how we did it.
          </p>
        </div>
      
        <div class="process-section">
          <h4 class="process-title">Fine-tuning Process</h4>
          <p class="process-description">
            There are three files involved in the fine-tuning process:
          </p>
          
          <div class="file-cards">
            <!-- Upload PDFs Card -->
            <div class="file-card">
              <h5 class="file-title">upload_pdfs.py</h5>
              <p class="file-description">Responsible for loading PDF files, cleaning the text, splitting the data</p>
              <div class="file-details">
                <p>This script performs the following steps:</p>
                <ul class="steps-list">
                  <li>Loads PDF files</li>
                  <li>Cleans the text</li>
                  <li>Splits the data (similar to the regular pipeline)</li>
                  <li>Prepares training and testing datasets</li>
                  <li>Saves data into CSV files</li>
                </ul>
                <p class="additional-info">
                  We prepare the dataset by pairing X as input medical papers and Y as output systematic reviews into a Pandas data frame. 
                  We created the dataset manually by looking up systematic reviews (Y) online and getting their reference papers (X). 
                  Then, we split the data into training and testing datasets with 80% for training and 20% for testing. 
                  After all these, we save them into training_data.csv and testing_data.csv.
                </p>
              </div>
            </div>
            
            <!-- Fine Tune Model Card -->
            <div class="file-card">
              <h5 class="file-title">fine_tune_model.py</h5>
              <p class="file-description">Handles the fine-tuning process of the pre-trained model</p>
              <div class="file-details">
                <p>This script explains the process of fine-tuning a pre-trained T5-small model (from Hugging Face) on the prepared dataset:</p>
                <ul class="steps-list">
                  <li>Loads the training_data.csv</li>
                  <li>Extracts X and Y</li>
                  <li>Creates a custom TensorFlow dataset class to tokenize the input X and target Y texts</li>
                  <li>Initializes the model</li>
                  <li>Compiles it with optimizer and computes the loss function</li>
                  <li>Trains the model on the dataset in batches of 8 for 3 epochs</li>
                  <li>Evaluates the model on the same dataset (we did not have time to create a validation dataset)</li>
                  <li>Saves the fine-tuned model and tokenizer to the fine-tuned-model directory</li>
                </ul>
              </div>
            </div>
            
            <!-- Try Model Card -->
            <div class="file-card">
              <h5 class="file-title">try_model.py</h5>
              <p class="file-description">Used for testing the fine-tuned model</p>
              <div class="file-details">
                <p>This script tests the fine-tuned model:</p>
                <ul class="steps-list">
                  <li>Loads the model from fine-tuned-model directory</li>
                  <li>Loads the testing_data.csv file with X_test and Y_test extracted</li>
                  <li>Creates a custom TensorFlow dataset class to tokenize X_test and Y_test texts</li>
                  <li>Compiles, computes loss, and evaluates</li>
                  <li>Prints the test loss</li>
                  <li>Generates predictions for the testing dataset and prints them in terminal</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      
        <div class="results-section">
          <h4 class="results-title">Results and Comparison</h4>
          <div class="results-content">
            <p class="results-text">
              Unfortunately, the result output was some sentences that aren't even grammatically correct, 
              many sentences were nonsensical and lack coherence. As the model failed to produce meaningful 
              systematic reviews, we did not conduct any measurement evaluations like BLEU scores.
            </p>
            <p class="results-text">
              Overall, it is an interesting experience, especially the fine-tuning process for transformer models. 
              Also, we understand that there is a lot of challenges beside writing the code itself, such as data quality, 
              pre-trained model itself, etc. If given more time and computational resources, we could try this on a larger 
              dataset and better language model, potentially achieving higher quality results.
            </p>
          </div>
          
          <div class="comparison-section">
            <h5 class="comparison-title">Comparison Between Outputs</h5>
            <p class="comparison-description">
              Here's the comparison between output from our fine-tuned model, and our current application output:
            </p>
            <h5>Comparison Between Outputs</h5>
            <p>
              Here's the comparison between output from our fine-tuned model, and our current application output:
            </p>
            <!-- Replace with your actual file paths -->
            <div class="code-block clickable-file" data-filepath="../../assets/content/fine-tuning-output.txt">
              <strong>Fine-tuned Model Output:</strong><br>
              <span class="file-content">Click to view fine-tuning output file</span>
            </div>
            
            <div class="code-block clickable-file" data-filepath="../../assets/content/current-output.txt">
              <strong>Current Application Output:</strong><br>
              <span class="file-content">Click to view current application output file</span>
            </div>  
          </div>
        </div>
      </div>
  </section>
</main>

<!-- ======= Footer ======= -->
<footer id="footer" class="footer text-white position-relative" style="background: linear-gradient(to right, #4b6cb7, #182848);">
  <!-- Here is a wave-shaped SVG to decorate the top. If you don't need the wave shape, you can delete this div -->
  <div class="wave-shape" style="position: absolute; top: -100px; left: 0; width: 100%; overflow: hidden; line-height: 0; transform: rotate(180deg);">
    <svg viewBox="0 0 500 150" preserveAspectRatio="none" style="position: relative; display: block; width: calc(100% + 1.3px); height: 100px;">
      <path d="M-2.19,29.63 C149.99,150.00 321.41,-49.99 502.54,44.96 L500.00,0.00 L0.00,0.00 Z"
            style="stroke: none; fill: #ffffff;"></path>
    </svg>
  </div>

  <div class="container pt-5" style="position: relative; z-index: 1;">
    <div class="row gy-4">
      <!-- Left: Site Info -->
      <div class="col-lg-4 col-md-6">
        <h3 class="fw-bold">Site Info</h3>
        <p>
          This is the website for UCL Year2 2020-2023 COMP106B Team4 Avanade's COVID19 changes,  
          which introduces the team project and contains all the portfolios.
        </p>
      </div>
      <!-- Middle: Site Menu -->
      <div class="col-lg-4 col-md-6">
        <h3 class="fw-bold">Site Menu</h3>
        <ul class="list-unstyled">
          <li><a href="../../index.html" class="text-white text-decoration-none">Home</a></li>
          <li><a href="requirements.html" class="text-white text-decoration-none">Requirements</a></li>
          <li><a href="research.html" class="text-white text-decoration-none">Research</a></li>
          <li><a href="algorithm.html" class="text-white text-decoration-none">Algorithm</a></li>
          <li><a href="system-design.html" class="text-white text-decoration-none">System Design</a></li>
          <li><a href="implements.html" class="text-white text-decoration-none">Implements</a></li>
          <li><a href="testing.html" class="text-white text-decoration-none">Testing</a></li>
          <li><a href="evaluation.html" class="text-white text-decoration-none">Evaluation</a></li>
          <li><a href="appendix.html" class="text-white text-decoration-none">Appendix</a></li>
        </ul>
      </div>
      <!-- Right: Project Supporters -->
      <div class="col-lg-4 col-md-12">
        <h3 class="fw-bold">Project Supporters</h3>
        <p class="mb-1">Avanade</p>
        <p class="mb-3">UCL</p>
        <p class="mb-0">
          A lot of thanks to our company partner Avanade and Mr. Kenza 404 especially.
        </p>
      </div>
    </div>

    <!-- Bottom copyright information -->
    <hr class="my-4">
    <div class="text-center pb-3">
      <p class="mb-0">© 2021 All Rights Reserved</p>
    </div>
  </div>
</footer>

<!-- Scroll Top -->
<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

<!-- Preloader -->
<div id="preloader"></div>

<!-- Vendor JS Files -->
<script src="../../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../../assets/vendor/php-email-form/validate.js"></script>
<script src="../../assets/vendor/aos/aos.js"></script>
<script src="../../assets/vendor/glightbox/js/glightbox.min.js"></script>
<script src="../../assets/vendor/swiper/swiper-bundle.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Add click handlers to all clickable file blocks
    document.querySelectorAll('.clickable-file').forEach(block => {
      block.addEventListener('click', function() {
        const filePath = this.getAttribute('data-filepath');
        window.open(filePath, '_blank');
      });
    });
  });
</script>

<!-- Main JS File -->
<script src="../../assets/js/main.js"></script>

</body>
</html>
